openapi: 3.0.3
info:
  title: Lamassu Device Manager API
  version: 1.0.0
  description: |
    Device inventory API providing lifecycle operations for devices managed by Lamassu IoT.
  contact:
    name: Lamassu IoT
    url: https://github.com/lamassuiot/lamassuiot
  license:
    name: Mozilla Public License 2.0
    url: https://github.com/lamassuiot/lamassuiot?tab=MPL-2.0-1-ov-file#readme

servers:
  - url: /api/devmanager/v1
    description: Device Manager API v1

tags:
  - name: Devices
    description: Device lifecycle operations
  - name: Device Groups
    description: Dynamic device grouping with hierarchical filtering
  - name: Stats
    description: Device statistics

paths:
  /stats:
    get:
      tags: [Stats]
      summary: Get device statistics
      description: |
        Retrieve device statistics including total count and count per status.
        Supports filtering by DMS, tags, metadata, creation time, and other device fields. 
        Filtering by status is not permitted as the endpoint always returns the status distribution for the matching devices.
        When no filters are provided, returns statistics for all devices.
      operationId: getDeviceStats
      parameters:
        - $ref: '#/components/parameters/Filter'
      responses:
        '200':
          description: Device statistics
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/DevicesStats'
              examples:
                all-devices:
                  summary: Statistics for all devices
                  value:
                    total: 150
                    status_distribution:
                      NO_IDENTITY: 10
                      ACTIVE: 100
                      RENEWAL_WINDOW: 15
                      ABOUT_TO_EXPIRE: 5
                      EXPIRED: 8
                      REVOKED: 7
                      DECOMMISSIONED: 5
        '400':
          description: Bad request - invalid filter or parameters (e.g., invalid status filter)
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

  /devices:
    get:
      tags: [Devices]
      summary: List devices
      operationId: getDevices
      parameters:
        - $ref: '#/components/parameters/PageSize'
        - $ref: '#/components/parameters/Bookmark'
        - $ref: '#/components/parameters/SortBy'
        - $ref: '#/components/parameters/SortMode'
        - $ref: '#/components/parameters/Filter'
      responses:
        '200':
          description: Devices list
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/GetDevicesResponse'
        '500': { $ref: '#/components/responses/InternalError' }
    post:
      tags: [Devices]
      summary: Create device
      operationId: createDevice
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreateDeviceBody'
      responses:
        '201':
          description: Created device
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Device'
        '400': { $ref: '#/components/responses/BadRequest' }
        '500': { $ref: '#/components/responses/InternalError' }

  /devices/{id}:
    get:
      tags: [Devices]
      summary: Get device by ID
      operationId: getDeviceById
      parameters:
        - $ref: '#/components/parameters/DeviceId'
      responses:
        '200':
          description: Device information
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Device'
        '400': { $ref: '#/components/responses/BadRequest' }
        '404': { $ref: '#/components/responses/NotFound' }
        '500': { $ref: '#/components/responses/InternalError' }
    delete:
      tags: [Devices]
      summary: Delete device
      operationId: deleteDevice
      parameters:
        - $ref: '#/components/parameters/DeviceId'
      responses:
        '204': { description: Device deleted }
        '400': { $ref: '#/components/responses/BadRequest' }
        '500': { $ref: '#/components/responses/InternalError' }

  /devices/{id}/idslot:
    put:
      tags: [Devices]
      summary: Update identity slot
      operationId: updateDeviceIdentitySlot
      parameters:
        - $ref: '#/components/parameters/DeviceId'
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UpdateDeviceIdentitySlotBody'
      responses:
        '200':
          description: Updated device
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Device'
        '400': { $ref: '#/components/responses/BadRequest' }
        '500': { $ref: '#/components/responses/InternalError' }

  /devices/{id}/metadata:
    put:
      tags: [Devices]
      summary: Update device metadata
      operationId: updateDeviceMetadata
      parameters:
        - $ref: '#/components/parameters/DeviceId'
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UpdateDeviceMetadataBody'
      responses:
        '200':
          description: Updated device
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Device'
        '400': { $ref: '#/components/responses/BadRequest' }
        '404': { $ref: '#/components/responses/NotFound' }
        '500': { $ref: '#/components/responses/InternalError' }
    patch:
      tags: [Devices]
      summary: Patch device metadata
      operationId: patchDeviceMetadata
      parameters:
        - $ref: '#/components/parameters/DeviceId'
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UpdateDeviceMetadataBody'
      responses:
        '200':
          description: Updated device
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Device'
        '400': { $ref: '#/components/responses/BadRequest' }
        '404': { $ref: '#/components/responses/NotFound' }
        '500': { $ref: '#/components/responses/InternalError' }

  /devices/{id}/decommission:
    delete:
      tags: [Devices]
      summary: Decommission device
      operationId: decommissionDevice
      parameters:
        - $ref: '#/components/parameters/DeviceId'
      responses:
        '204': { description: Device decommissioned }
        '400': { $ref: '#/components/responses/BadRequest' }
        '500': { $ref: '#/components/responses/InternalError' }

  /devices/dms/{id}:
    get:
      tags: [Devices]
      summary: List devices managed by a DMS
      operationId: getDevicesByDMS
      parameters:
        - name: id
          in: path
          required: true
          description: DMS identifier
          schema:
            type: string
        - $ref: '#/components/parameters/PageSize'
        - $ref: '#/components/parameters/Bookmark'
        - $ref: '#/components/parameters/SortBy'
        - $ref: '#/components/parameters/SortMode'
        - $ref: '#/components/parameters/Filter'
      responses:
        '200':
          description: Devices for the DMS
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/GetDevicesResponse'
        '400': { $ref: '#/components/responses/BadRequest' }
        '500': { $ref: '#/components/responses/InternalError' }

  /device-groups:
    get:
      tags: [Device Groups]
      summary: List device groups
      description: |
        Retrieve all device groups with optional pagination, sorting, and filtering.
        Device groups can be organized hierarchically with parent-child relationships.
      operationId: getDeviceGroups
      parameters:
        - $ref: '#/components/parameters/PageSize'
        - $ref: '#/components/parameters/Bookmark'
        - $ref: '#/components/parameters/SortBy'
        - $ref: '#/components/parameters/SortMode'
        - $ref: '#/components/parameters/DeviceGroupFilter'
      responses:
        '200':
          description: Device groups list
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/GetDeviceGroupsResponse'
              examples:
                groups-list:
                  summary: List of device groups
                  value:
                    next: ""
                    list:
                      - id: "550e8400-e29b-41d4-a716-446655440000"
                        name: "Production Devices"
                        description: "All production environment devices"
                        parent_id: null
                        criteria:
                          - field: "tags"
                            operand: "contains"
                            value: "production"
                        created_at: "2026-01-15T10:00:00Z"
                        updated_at: "2026-01-15T10:00:00Z"
                      - id: "660e8400-e29b-41d4-a716-446655440001"
                        name: "Production Sensors"
                        description: "Production sensors only"
                        parent_id: "550e8400-e29b-41d4-a716-446655440000"
                        criteria:
                          - field: "tags"
                            operand: "contains"
                            value: "sensor"
                        created_at: "2026-01-15T11:00:00Z"
                        updated_at: "2026-01-15T11:00:00Z"
        '500': { $ref: '#/components/responses/InternalError' }
    post:
      tags: [Device Groups]
      summary: Create device group
      description: |
        Create a new device group with optional parent and filter criteria.
        Criteria are filter expressions that determine group membership.
        Groups can form hierarchies by specifying a parent_id.
        
        The response includes:
        - `criteria`: The filters specified in the request for this group
        - `inherited_criteria`: All filters from ancestor groups (parent, grandparent, etc.) composed from root to parent
        
        Filter operands are returned as human-readable names (e.g., "contains", "eq").
      operationId: createDeviceGroup
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreateDeviceGroupBody'
            examples:
              root-group:
                summary: Root group with tag filter
                value:
                  id: "550e8400-e29b-41d4-a716-446655440000"
                  name: "Production Devices"
                  description: "All production environment devices"
                  criteria:
                    - field: "tags"
                      operand: "contains"
                      value: "production"
              nested-group:
                summary: Nested group with multiple criteria
                value:
                  id: "660e8400-e29b-41d4-a716-446655440001"
                  name: "Active Production Sensors"
                  description: "Active sensors in production"
                  parent_id: "550e8400-e29b-41d4-a716-446655440000"
                  criteria:
                    - field: "tags"
                      operand: "contains"
                      value: "sensor"
                    - field: "status"
                      operand: "eq"
                      value: "ACTIVE"
      responses:
        '201':
          description: Device group created
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/DeviceGroup'
        '400':
          description: Bad request - invalid criteria, circular reference, or validation error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
              examples:
                invalid-field:
                  summary: Invalid filter field
                  value:
                    err: "invalid filter field 'invalid_field' in criteria"
                circular-ref:
                  summary: Circular reference detected
                  value:
                    err: "circular parent reference detected"
        '404':
          description: Parent group not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '500': { $ref: '#/components/responses/InternalError' }

  /device-groups/{id}:
    get:
      tags: [Device Groups]
      summary: Get device group by ID
      description: |
        Retrieve a specific device group by its identifier.
        
        The response includes:
        - `criteria`: The filters defined specifically for this group
        - `inherited_criteria`: All filters from ancestor groups (parent, grandparent, etc.) composed from root to parent
        
        Filter operands are returned as human-readable names (e.g., "contains", "eq").
      operationId: getDeviceGroupByID
      parameters:
        - name: id
          in: path
          required: true
          description: Device group identifier
          schema:
            type: string
            format: uuid
      responses:
        '200':
          description: Device group details
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/DeviceGroup'
        '404': { $ref: '#/components/responses/NotFound' }
        '500': { $ref: '#/components/responses/InternalError' }
    put:
      tags: [Device Groups]
      summary: Update device group
      description: |
        Update an existing de:
        - `criteria`: The group's own filters (updated if provided in request)
        - `inherited_criteria`: All filters from ancestor groups (parent, grandparent, etc.) composed from root to parent
        es.
        
        The response includes all filters from the entire hierarchy (parent, grandparent, etc.)
        composed in the criteria field, not just the filters specified in the request.
        Filter operands are returned as human-readable names (e.g., "contains", "eq").
      operationId: updateDeviceGroup
      parameters:
        - name: id
          in: path
          required: true
          description: Device group identifier
          schema:
            type: string
            format: uuid
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UpdateDeviceGroupBody'
            examples:
              update-criteria:
                summary: Update group criteria
                value:
                  name: "Production Devices (Updated)"
                  description: "Updated description"
                  criteria:
                    - field: "tags"
                      operand: "contains"
                      value: "production"
                    - field: "status"
                      operand: "eq"
                      value: "ACTIVE"
      responses:
        '200':
          description: Device group updated
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/DeviceGroup'
        '400':
          description: Bad request - invalid criteria or circular reference
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '404': { $ref: '#/components/responses/NotFound' }
        '500': { $ref: '#/components/responses/InternalError' }
    delete:
      tags: [Device Groups]
      summary: Delete device group
      description: |
        Delete a device group. Child groups are not automatically deleted.
        If a group has children, consider reassigning or deleting them first.
      operationId: deleteDeviceGroup
      parameters:
        - name: id
          in: path
          required: true
          description: Device group identifier
          schema:
            type: string
            format: uuid
      responses:
        '204': { description: Device group deleted }
        '404': { $ref: '#/components/responses/NotFound' }
        '500': { $ref: '#/components/responses/InternalError' }

  /device-groups/{id}/devices:
    get:
      tags: [Device Groups]
      summary: Get devices in group
      description: |
        Retrieve all devices matching the group's filter criteria.
        Criteria are inherited and composed from parent groups in the hierarchy.
        Supports additional filtering, pagination, and sorting.
      operationId: getDevicesByGroup
      parameters:
        - name: id
          in: path
          required: true
          description: Device group identifier
          schema:
            type: string
            format: uuid
        - $ref: '#/components/parameters/PageSize'
        - $ref: '#/components/parameters/Bookmark'
        - $ref: '#/components/parameters/SortBy'
        - $ref: '#/components/parameters/SortMode'
        - $ref: '#/components/parameters/Filter'
      responses:
        '200':
          description: Devices matching group criteria
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/GetDevicesResponse'
              examples:
                filtered-devices:
                  summary: Devices in production sensors group
                  value:
                    next: ""
                    list:
                      - id: "dev-001"
                        tags: ["production", "sensor", "temperature"]
                        status: "ACTIVE"
                        icon: "thermometer"
                        icon_color: "#FF5733"
                        creation_timestamp: "2026-01-10T08:00:00Z"
                        metadata: { "location": "warehouse-a" }
                        dms_owner: "dms-prod"
        '404': { $ref: '#/components/responses/NotFound' }
        '500': { $ref: '#/components/responses/InternalError' }

  /device-groups/{id}/stats:
    get:
      tags: [Device Groups]
      summary: Get device group statistics
      description: |
        Retrieve statistics for devices matching the group's filter criteria.
        Returns total device count and distribution across all status types.
        Criteria are inherited from parent groups in the hierarchy.
      operationId: getDeviceGroupStats
      parameters:
        - name: id
          in: path
          required: true
          description: Device group identifier
          schema:
            type: string
            format: uuid
      responses:
        '200':
          description: Device group statistics
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/DeviceGroupStats'
              examples:
                group-stats:
                  summary: Statistics for production sensors
                  value:
                    total_devices: 150
                    devices_status:
                      NO_IDENTITY: 10
                      ACTIVE: 100
                      RENEWAL_WINDOW: 15
                      ABOUT_TO_EXPIRE: 5
                      EXPIRED: 8
                      REVOKED: 7
                      DECOMMISSIONED: 5
        '404': { $ref: '#/components/responses/NotFound' }
        '500': { $ref: '#/components/responses/InternalError' }

components:
  parameters:
    DeviceId:
      name: id
      in: path
      required: true
      description: Device identifier
      schema:
        type: string
    PageSize:
      name: page_size
      in: query
      required: false
      schema:
        type: integer
        default: 25
    Bookmark:
      name: bookmark
      in: query
      required: false
      schema:
        type: string
    SortBy:
      name: sort_by
      in: query
      required: false
      schema:
        type: string
    SortMode:
      name: sort_mode
      in: query
      required: false
      schema:
        type: string
        enum: [asc, desc]
    Filter:
      name: filter
      in: query
      required: false
      schema:
        type: string
      description: |
        Filter expression for device search. Supports filtering by multiple fields with various operators.
        
        **Supported Fields:**
        - `id` (string): Device identifier
        - `dms_owner` (string): DMS identifier
        - `status` (enum): Device status (NO_IDENTITY, ACTIVE, RENEWAL_WINDOW, ABOUT_TO_EXPIRE, EXPIRED, REVOKED, DECOMMISSIONED)
        - `tags` (array): Device tags
        - `creation_timestamp` (date): Device creation time
        
        **String Operators:**
        - `eq` - equal (case-sensitive)
        - `eq_ic` - equal ignore case
        - `ne` - not equal (case-sensitive)
        - `ne_ic` - not equal ignore case
        - `ct` - contains (case-sensitive)
        - `ct_ic` - contains ignore case
        - `nc` - not contains (case-sensitive)
        - `nc_ic` - not contains ignore case
        
        **Array Operators:**
        - `contains` - contains value (case-sensitive)
        - `contains_ic` - contains value ignore case
        
        **Date Operators:**
        - `eq` - equal
        - `bf` - before
        - `af` - after
        
        **Enum Operators:**
        - `eq` - equal
        - `ne` - not equal
        
        **Examples:**
        - Filter by DMS: `filter=dms_owner[eq]:dms-production`
        - Case-insensitive search: `filter=dms_owner[eq_ic]:DMS-Production`
        - Filter by tag: `filter=tags[contains]:production`
        - Case-insensitive tag: `filter=tags[contains_ic]:PRODUCTION`
        - Filter by status: `filter=status[eq]:ACTIVE`
        - Multiple filters: `filter=dms_owner[eq]:dms-prod&filter=tags[contains]:server`
        - Date range: `filter=creation_timestamp[af]:2024-01-01T00:00:00Z`

    DeviceGroupFilter:
      name: filter
      in: query
      required: false
      schema:
        type: string
      description: |
        Filter expression for device group search. Supports filtering by group properties.
        
        **Supported Fields:**
        - `id` (string): Group identifier
        - `name` (string): Group name
        - `parent_id` (string): Parent group identifier
        - `created_at` (date): Group creation time
        - `updated_at` (date): Group last update time
        
        Uses the same operators as device filters. Examples:
        - Filter by name: `filter=name[eq_ic]:production`
        - Filter root groups: `filter=parent_id[is_null]:true`
        - Filter by parent: `filter=parent_id[eq]:550e8400-e29b-41d4-a716-446655440000`

  responses:
    BadRequest:
      description: Invalid request
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/Error'
    NotFound:
      description: Resource not found
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/Error'
    InternalError:
      description: Internal server error
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/Error'

  schemas:
    CreateDeviceBody:
      type: object
      properties:
        id:
          type: string
        alias:
          type: string
        tags:
          type: array
          items:
            type: string
        metadata:
          type: object
          additionalProperties: true
        dms_id:
          type: string
        icon:
          type: string
        icon_color:
          type: string

    UpdateDeviceIdentitySlotBody:
      type: object
      properties:
        status:
          type: string
        active_version:
          type: integer
        type:
          type: string
        versions:
          type: object
          additionalProperties: true

    UpdateDeviceMetadataBody:
      type: object
      properties:
        patches:
          type: array
          items:
            $ref: '#/components/schemas/PatchOperation'

    GetDevicesResponse:
      type: object
      properties:
        next:
          type: string
        list:
          type: array
          items:
            $ref: '#/components/schemas/Device'

    CreateDeviceGroupBody:
      type: object
      required:
        - id
        - name
        - criteria
      properties:
        id:
          type: string
          format: uuid
          description: Unique identifier for the device group
        name:
          type: string
          description: Human-readable name for the group
          minLength: 1
          maxLength: 255
        description:
          type: string
          description: Optional description of the group's purpose
        parent_id:
          type: string
          format: uuid
          nullable: true
          description: Parent group ID for hierarchical organization
        criteria:
          type: array
          description: Filter criteria to determine group membership
          items:
            $ref: '#/components/schemas/DeviceGroupFilterOption'
      example:
        id: "550e8400-e29b-41d4-a716-446655440000"
        name: "Production Devices"
        description: "All production environment devices"
        criteria:
          - field: "tags"
            operand: "contains"
            value: "production"

    UpdateDeviceGroupBody:
      type: object
      properties:
        name:
          type: string
          description: Updated name for the group
          minLength: 1
          maxLength: 255
        description:
          type: string
          description: Updated description
        parent_id:
          type: string
          format: uuid
          nullable: true
          description: Updated parent group ID (validated for circular references)
        criteria:
          type: array
          description: Updated filter criteria
          items:
            $ref: '#/components/schemas/DeviceGroupFilterOption'
      example:
        name: "Production Devices (Updated)"
        description: "Updated description"
        criteria:
          - field: "tags"
            operand: "contains"
            value: "production"

    DeviceGroupFilterOption:
      type: object
      required:
        - field
        - operand
        - value
      properties:
        field:
          type: string
          description: Device field to filter on (must be a valid DeviceFilterableField)
          enum:
            - id
            - dms_owner
            - status
            - tags
            - creation_timestamp
            - metadata
          example: "tags"
        operand:
          type: string
          description: |
            Filter operation name. Allowed operands depend on the field type:
            
            **String fields (id, dms_owner):**
            - `eq`, `equal` - Exact match (case-sensitive)
            - `eq_ic`, `equal_ignorecase` - Exact match (case-insensitive)
            - `ne`, `notequal` - Not equal (case-sensitive)
            - `ne_ic`, `notequal_ignorecase` - Not equal (case-insensitive)
            - `ct`, `contains` - Contains substring (case-sensitive)
            - `ct_ic`, `contains_ignorecase` - Contains substring (case-insensitive)
            - `nc`, `notcontains` - Does not contain (case-sensitive)
            - `nc_ic`, `notcontains_ignorecase` - Does not contain (case-insensitive)
            
            **String array fields (tags):**
            - `contains` - Array contains value (case-sensitive)
            - `contains_ignorecase` - Array contains value (case-insensitive)
            
            **Date fields (creation_timestamp):**
            - `eq`, `equal` - Exact date match
            - `bf`, `before` - Before date
            - `af`, `after` - After date
            
            **Enum fields (status):**
            - `eq`, `equal` - Exact enum value match
            - `ne`, `notequal` - Not equal to enum value
            
            **JSON fields (metadata):**
            - `jsonpath` - JSONPath expression
          enum:
            - eq
            - equal
            - eq_ic
            - equal_ignorecase
            - ne
            - notequal
            - ne_ic
            - notequal_ignorecase
            - ct
            - contains
            - ct_ic
            - contains_ignorecase
            - nc
            - notcontains
            - nc_ic
            - notcontains_ignorecase
            - bf
            - before
            - af
            - after
            - jsonpath
          example: "contains"
        value:
          type: string
          description: Value to compare against
          example: "production"

    DeviceGroup:
      type: object
      properties:
        id:
          type: string
          format: uuid
        name:
          type: string
        description:
          type: string
        parent_id:
          type: string
          format: uuid
          nullable: true
          description: Parent group ID for hierarchical organization
        criteria:
          type: array
          description: |
            Filter criteria defined for this specific group.
            These are the filters that were explicitly set when creating/updating this group.
          items:
            $ref: '#/components/schemas/DeviceGroupFilterOption'
        inherited_criteria:
          type: array
          description: |
            Filter criteria inherited from all ancestor groups in the hierarchy.
            Composed from root to immediate parent, in order.
            This field allows distinguishing the group's own filters from inherited ones.
            When querying devices in this group, both inherited_criteria and criteria are applied.
          items:
            $ref: '#/components/schemas/DeviceGroupFilterOption'
        created_at:
          type: string
          format: date-time
        updated_at:
          type: string
          format: date-time
      example:
        id: "550e8400-e29b-41d4-a716-446655440000"
        name: "Production Devices"
        description: "All production environment devices"
        parent_id: null
        criteria:
          - field: "tags"
            operand: "contains"
            value: "production"
        inherited_criteria: []
        created_at: "2026-01-15T10:00:00Z"
        updated_at: "2026-01-15T10:00:00Z"

    GetDeviceGroupsResponse:
      type: object
      properties:
        next:
          type: string
          description: Pagination bookmark for next page
        list:
          type: array
          items:
            $ref: '#/components/schemas/DeviceGroup'

    DeviceGroupStats:
      type: object
      properties:
        total_devices:
          type: integer
          description: Total number of devices matching group criteria
        devices_status:
          type: object
          description: Device count per status type
          additionalProperties:
            type: integer
      example:
        total_devices: 150
        devices_status:
          NO_IDENTITY: 10
          ACTIVE: 100
          RENEWAL_WINDOW: 15
          ABOUT_TO_EXPIRE: 5
          EXPIRED: 8
          REVOKED: 7
          DECOMMISSIONED: 5


    Device:
      type: object
      properties:
        id:
          type: string
        tags:
          type: array
          items:
            type: string
        status:
          type: string
        icon:
          type: string
        icon_color:
          type: string
        creation_timestamp:
          type: string
          format: date-time
        metadata:
          type: object
          additionalProperties: true
        dms_owner:
          type: string
        identity:
          type: object
          description: Active identity slot
        slots:
          type: object
          additionalProperties: true
        events:
          type: object
          additionalProperties: true

    DevicesStats:
      type: object
      properties:
        total:
          type: integer
        status_distribution:
          type: object
          additionalProperties:
            type: integer

    PatchOperation:
      type: object
      properties:
        op:
          type: string
          enum:
            - add
            - remove
            - replace
            - move
            - copy
            - test
        path:
          type: string
        value:
          description: Operation value
        from:
          type: string
          description: Used only with 'move' and 'copy' operations to indicate the source path.
    Error:
      type: object
      properties:
        err:
          type: string

  securitySchemes:
    BearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT
      description: JWT token authentication

security:
  - BearerAuth: []
